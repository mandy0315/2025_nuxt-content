import{h as ee}from"./CW7irCmf.js";import{A as J,d as te,y as S,l as L,ak as H,B as ae,al as ne,M as le,am as oe,an as se,a3 as ie,X as ue,a as $,ao as K,ap as Le,ag as re,aq as ce,ar as de,Z as fe,L as q,a0 as pe,F as z,as as ve}from"./C_-Ao5nl.js";function me(t=J()){var o;return(o=t.ssrContext)==null?void 0:o.event}const he={trailing:!0};function ye(t,o=25,s={}){if(s={...he,...s},!Number.isFinite(o))throw new TypeError("Expected `wait` to be a finite number");let x,c,i=[],u,_;const d=(f,n)=>(u=ge(t,f,n),u.finally(()=>{if(u=null,s.trailing&&_&&!c){const A=d(f,_);return _=null,A}}),u);return function(...f){return u?(s.trailing&&(_=f),u):new Promise(n=>{const A=!c&&s.leading;clearTimeout(c),c=setTimeout(()=>{c=null;const b=s.leading?x:d(this,f);for(const p of i)p(b);i=[]},o),A?(x=d(this,f),n(x)):i.push(n)})}}async function ge(t,o,s){return await t.apply(o,s)}const w="_islandPromises",V=/data-island-uid="([^"]*)"/,_e=/data-island-uid(="")?(?!="[^"])/g,Se=/data-island-slot="([^"]*)"/g,we=/ data-island-slot="([^"]*)"[^>]*>/g,xe=/^<[^> ]*/;let Ae=1;const be=()=>(Ae++).toString();const Re=te({name:"NuxtIsland",inheritAttrs:!1,props:{name:{type:String,required:!0},lazy:Boolean,props:{type:Object,default:()=>{}},context:{type:Object,default:()=>({})},scopeId:{type:String,default:()=>{}},source:{type:String,default:()=>{}},dangerouslyLoadClientComponents:{type:Boolean,default:!1}},emits:["error"],async setup(t,{slots:o,expose:s,emit:x}){var T,j,k,N,D,F;let c=!1;const i=S(0),u=S(0),_=L(()=>H),d=S(null),f=fe(),n=J(),A=L(()=>t.props?Object.fromEntries(Object.entries(t.props).filter(([a])=>!a.startsWith("data-v-"))):{}),b=L(()=>ee([t.name,A.value,t.context,t.source])),p=le();me();let C;const Q=globalThis.fetch,I=S(!1);ae(()=>{I.value=!0,i.value++}),ne(()=>{C&&C.dispose()});function W(a,e){const l={};e.props&&(l.props=e.props),e.slots&&(l.slots=e.slots),e.components&&(l.components=e.components),e.head&&(l.head=e.head),n.payload.data[a]={__nuxt_island:{key:a,params:{...t.context,props:t.props?JSON.stringify(t.props):void 0},result:l},...e}}const v={};if(p.vnode.el){const a=(T=oe(n.payload.data[`${t.name}_${b.value}`]))==null?void 0:T.slots;a&&(v.slots=a)}const g=S("");if((j=p.vnode)!=null&&j.el){g.value=((k=se(p.vnode.el,!0))==null?void 0:k.join(""))||"";const a=`${t.name}_${b.value}`;(N=n.payload.data)[a]||(N[a]={}),n.payload.data[a].html=g.value.replaceAll(new RegExp(`data-island-uid="${((D=g.value.match(V))==null?void 0:D[1])||""}"`,"g"),'data-island-uid=""')}const m=S(((F=g.value.match(V))==null?void 0:F[1])||be()),X=L(()=>[...g.value.matchAll(Se)].map(a=>a[1])),O=L(()=>{const a=Object.keys(o);let e=g.value;if(t.scopeId&&(e=e.replace(xe,l=>l+" "+t.scopeId)),!_.value)for(const[l,h]of Object.entries(v.components||{}))e=e.replace(new RegExp(` data-island-uid="${m.value}" data-island-component="${l}"[^>]*>`),r=>r+h.html);return v.slots?e.replaceAll(we,(l,h)=>{var r,y;return a.includes(h)?l:l+(((y=(r=v.slots)==null?void 0:r[h])==null?void 0:y.fallback)||"")}):e}),Z=ie();async function G(a=!1){var y;const e=`${t.name}_${b.value}`;if(!a&&((y=n.payload.data[e])!=null&&y.html))return n.payload.data[e];const l=`/__nuxt_island/${e}.json`,r=await(await Q(ce(t.source?l:de(f.app.baseURL??"",l),{...t.context,props:t.props?JSON.stringify(t.props):void 0}))).json();return W(e,r),r}async function R(a=!1){n[w]=n[w]||{},n[w][m.value]||(n[w][m.value]=G(a).finally(()=>{delete n[w][m.value]}));try{const e=await n[w][m.value];g.value=e.html.replaceAll(_e,`data-island-uid="${m.value}"`),u.value++,d.value=null,v.slots=e.slots||{},v.components=e.components||{},e!=null&&e.head&&(C?C.patch(e.head):C=Z.push(e.head)),re(()=>{c=!0,i.value++})}catch(e){d.value=e,x("error",e)}}return s({refresh:()=>R(!0)}),ue(t,ye(()=>R(),100),{deep:!0}),!p.vnode.el&&t.lazy?R():(!p.vnode.el||!n.payload.serverRendered)&&await R(),(a,e)=>{var l;return!O.value||d.value?[((l=o.fallback)==null?void 0:l.call(o,{error:d.value}))??$("div")]:[K([u.value],()=>$(z,{key:u.value},[q(pe(O.value||"<div></div>",1))]),e,0),K([i.value],()=>{var y;const h=[],r=i.value===0||!!(i.value&&!(i.value%2));if(m.value&&O.value&&(t.lazy?c:I.value||(y=p.vnode)!=null&&y.el))for(const E in o)X.value.includes(E)&&h.push($(ve,{to:`${r?"div":""}[data-island-uid="${m.value}"][data-island-slot="${E}"]`},{default:()=>{var P,U,B;return((B=(U=(P=v.slots)==null?void 0:P[E])==null?void 0:U.props)!=null&&B.length?v.slots[E].props:[{}]).map(Y=>{var M;return(M=o[E])==null?void 0:M.call(o,Y)})}}));return q(z,h)},e,1)]}}});export{Re as default};
